# Clojure Web Repl ([clojurescript.io](http://www.clojurescript.io))


A reagent app designed to embed a pure ClojureScript REPL in a web
page. Plumbing kindly provided by
[replumb](https://github.com/ScalaConsultants/replumb). It employs the
following libraries, whose authors we will always be grateful to:

* [regent](https://github.com/reagent-project/reagent)
* [re-frame](https://github.com/Day8/re-frame)
* [re-com](https://github.com/Day8/re-com)
* [markdown-clj](https://github.com/yogthos/markdown-clj)
* [hickory](https://github.com/davidsantiago/hickory)
* [CodeMirror](https://github.com/codemirror/CodeMirror)
* [showdown](https://github.com/showdownjs/showdown)
* [enquire.js](https://github.com/WickyNilliams/enquire.js)
* ...and more

## Development

### Generate the ClojureScript API 

To generate the doc panel, this project performs a simple transformation of the
data taken from the amazing work at
[cljs-api-info](https://github.com/cljsinfo/cljs-api-docs). The new doc will be
stored in the `cljs-repl-web.cljs-api` namespace.

The generator/transformer needs the `cljs-api.edn` file from the project. One
easy way is to get it is to checkout a
[tag](https://github.com/cljsinfo/cljs-api-docs/tree/1.7.228) and copy it to
`resources`.

Then run:

`lein run -m cljs-api.generator/-main`

## Development Mode

In dev mode, an `out` folder, containing all the compiled dependencies will be
also created in the same folder of `cljs-repl-web.js`.  The main JavaScript
file will be `cljs-repl-web.js` and it is located in
`resources/public/js/compiled`.

#### Figwheel:

`lein fig-dev`  **or** `lein fig-dev*` if you want to clean as well.

Figwheel will automatically push cljs changes to the browser.

Wait a bit, then browse to [http://localhost:3449](http://localhost:3449).

#### Vanilla ClojureScript REPL:

This is useful in order to be sure that Figwheel does not interfere with the
classpath.

There is a problem, solved
[here](https://github.com/tailrecursion/lein-simpleton/pull/7) in
`lein-simpleton`, so you need either to wait for the merge and then point to
the correct version or build locally from my branch (at the moment the latest
is `1.4.0-SNAPSHOT`):

```
git clone -b from-fix git@github.com:arichiardi/lein-simpleton.git
cd lein-simpleton
lein install
```

After that, you should have the fixed jar in `.m2/repository`. Come back to `cljs-repl-web` and build the project with `lein cljsbuild once dev`. Open two terminals.

In the first one, execute:
`./scripts/brepl`  (or `./scripts/brepl.bat`, untested, for Windows)

In the second one, execute:
```
lein simpleton 5042 :from resources/public
```

Then connect your browser to `http://localhost:5042` (your app will appear).

If you want an alias, launch `lein serve-dev` or `lein serve-prod`.

## Production Build

For having a
[working `require`](http://blog.scalac.io/2015/12/21/cljs-replumb-require.html),
the `out` folder generated by `lein cljsbuild once dev` needs to be uploaded to
the web server. This will be improved: an additional plugin/tool could collect
all the necessary sources from `project.clj` and pack them in an optimized way
easily.

At the moment the project reads sources from `/cljs-src` if compiled with
`prod` profile or from `js/compiled/out` if compiled with `dev` profile.

For the `prod` artifact run:

`lein minify*`, the asterisk adds `lein clean`

## Testing

Tests at the moment complete in PhantomJS and SlimerJS, but are just a few.

You can test inside the browser's Developer Console after having booted
Figwheel using `luncher.test.run()`.

For headless tests you need first of all
[PhantomJS](https://github.com/ariya/phantomjs/) and/or
[SlimerJS](http://slimerjs.org/), after which you can: `lein test-phantom`
and/or `lein test-slimer` respectively. Featuring
[doo](https://github.com/bensu/doo) here.

## Other Resources

 * [CLJSJS](https://github.com/cljsjs/packages)


### License

Distributed under the Eclipse Public License, the same as Clojure.

Copyright (C) 2015-16 Scalac Sp. z o.o.

Scalac [scalac.io](http://scalac.io/?utm_source=scalac_github&utm_campaign=scalac1&utm_medium=web) is a full-stack team of great functional developers focused around Scala/Clojure backed by great frontend and mobile developers.

On our [blog](http://blog.scalac.io/?utm_source=scalac_github&utm_campaign=scalac1&utm_medium=web) we share our knowledge with community on how to write great, clean code, how to work remotely and about our culture.
